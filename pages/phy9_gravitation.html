<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bondona Tutor ‚Äî Physics ‚Ä¢ Chapter 9: Gravitation</title>
  <style>
    :root{ --bg:#f6fbff; --card:#ffffff; --ink:#0b3b5a; --muted:#4d6b80; --accent:#26a6ff; --good:#14b86e; --bad:#ff4d6d; --ring:#d9eefb; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(180deg,var(--bg),#e9f6ff 70%);color:var(--ink)}
    .wrap{max-width:1100px;margin:auto;padding:20px}
    .card{background:var(--card);border-radius:20px;box-shadow:0 10px 30px rgba(13,71,161,.08);padding:20px}
    h1{margin:0 0 6px 0}
    .tag{display:inline-block;background:#eaf7ff;border-radius:999px;padding:4px 10px;color:#1673a6;font-size:12px}
    .grid{display:grid;grid-template-columns: 1fr;gap:20px}
    .speech{position:relative;background:#fff;border:2px solid #d9eefb;border-radius:18px;padding:16px;min-height:120px}
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    button{appearance:none;border:none;background:var(--accent);color:#fff;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;box-shadow:0 6px 16px rgba(38,166,255,.24)}
    button.ghost{background:#eaf7ff;color:#0b5a8a;box-shadow:none}
    .muted{color:#4d6b80;font-size:13px}
    .pill{display:inline-block;padding:2px 10px;border-radius:999px;background:#eef7ff;border:1px solid #cfeeff;color:#0b3b5a;font-size:12px}
    .sim{background:#fff;border:2px solid #d9eefb;border-radius:16px;padding:16px}
    .panel{display:grid;grid-template-columns: 320px 1fr;gap:16px;align-items:stretch}
    .explorer{position:relative;height:480px;border:2px dashed var(--ring);border-radius:16px;overflow:hidden;background:radial-gradient(circle at center, #ffffff 0, #f7fbff 70%)}
    .viewport{position:absolute;left:0;top:0;transform-origin:0 0;cursor:grab;will-change:transform;backface-visibility:hidden;transform:translateZ(0)}
    .viewport:active{cursor:grabbing}
    .legend{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .side{background:#f8fcff;border:1px solid #d9eefb;border-radius:12px;padding:10px}
    .side h4{margin:0 0 6px 0}
    .side .row{display:grid;grid-template-columns: 1fr auto;align-items:center;gap:8px}
    .list{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:6px;margin-top:8px}
    svg *{vector-effect:non-scaling-stroke;shape-rendering:geometricPrecision}
    svg .org{cursor:pointer;transition:filter .2s ease}
    svg .org:hover{filter:brightness(1.08)}
    .quiz{margin-top:18px;background:#fff;border:2px dashed #cfeeff;border-radius:16px;padding:14px}
    .q{margin:10px 0}
    .phet{background:#fff;border:2px solid #d9eefb;border-radius:16px;padding:16px}
    .phet-frame{position:relative;width:100%;height:560px;border-radius:12px;overflow:hidden}
    iframe.phet-embed{width:100%;height:100%;border:0;display:block}
    .warn{background:#fffceb;border:1px solid #ffe08a;border-radius:10px;padding:10px}
    .pulse{position:relative}
    .pulse::after{content:"";position:absolute;inset:-8px;border:2px solid #cfeeff;border-radius:999px;opacity:.6;animation:pulse 1.8s ease-out infinite}
    @keyframes pulse{0%{transform:scale(.85);opacity:.6}70%{transform:scale(1.15);opacity:0}100%{transform:scale(1.15);opacity:0}}
    .mini{font-size:12px;color:#4d6b80}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Physics ‚Ä¢ Chapter 9: Gravitation</h1>
    <div class="tag">Universal Law ‚Ä¢ Free Fall & g ‚Ä¢ Mass & Weight ‚Ä¢ Thrust & Pressure ‚Ä¢ Archimedes ‚Ä¢ Relative Density</div>

    <div class="grid">
      <!-- Story / Overview -->
      <section>
        <div class="speech" id="speech"></div>
        <div class="controls">
          <button id="btnPrev" class="ghost">‚óÅ Prev</button>
          <button id="btnNext">Next ‚ñ∑</button>
          <button id="btnEnable" class="ghost">üîä Enable Audio</button>
          <button id="btnSpeak">‚ñ∂ Narrate (Male)</button>
          <span class="muted" id="lineInfo"></span>
        </div>
      </section>

      <!-- Zoomable Explorer -->
      <section class="sim">
        <h3>Lab: Gravitation Explorer</h3>
        <div class="panel">
          <div class="side">
            <div class="row"><h4>Choose Board</h4>
              <select id="boardType" style="padding:8px;border:2px solid #cfeeff;border-radius:10px;font-weight:700;color:#0b3b5a">
                <option value="law">Universal Law</option>
                <option value="freefall">Free Fall & g</option>
                <option value="massweight">Mass & Weight</option>
                <option value="pressure">Thrust & Pressure</option>
                <option value="arch">Archimedes & Buoyancy</option>
              </select>
            </div>
            <div class="row" style="margin-top:8px"><span class="pill">Zoom: <span id="zoomLabel">100%</span></span>
              <input id="zoom" type="range" min="80" max="200" value="100" step="5">
            </div>
            <div class="legend">
              <span class="pill">Tap items ‚Üí hear + learn</span>
              <button id="btnCenter" class="ghost">üéØ Center</button>
              <button id="btnMute" class="ghost">üîá Mute</button>
            </div>
            <div class="side" id="infoBox" style="margin-top:10px">
              <h4 id="orgName">Tap an item</h4>
              <div id="orgDesc" class="muted">I will tell you what it means.</div>
              <div class="controls" style="margin-top:8px"><button id="orgSpeak" class="ghost">‚ñ∂ Speak</button></div>
            </div>

            <div class="list" id="legendList"></div>
          </div>

          <div class="explorer" id="explorer">
            <div class="viewport" id="viewport">
              <svg id="boardSVG" viewBox="0 0 1100 760" width="1100" height="760" aria-label="Gravitation boards"></svg>
            </div>
          </div>
        </div>
        <p class="muted">Tip: Use the slider to zoom. Drag the background to pan. Tap a card or sketch to hear and learn. Switch boards from the dropdown.</p>
      </section>

      <!-- PhET Gravity Force Lab (online + fallbacks) -->
      <section class="phet">
        <h3>Interactive: PhET ‚Äî Gravity Force Lab</h3>
        <div class="phet-frame">
          <iframe
            id="phetFrame"
            class="phet-embed"
            title="PhET Gravity Force Lab"
            src="https://phet.colorado.edu/sims/html/gravity-force-lab/latest/gravity-force-lab_en.html"
            allow="fullscreen; gamepad; xr-spatial-tracking; clipboard-read; clipboard-write"
            sandbox="allow-scripts allow-forms allow-same-origin allow-pointer-lock allow-popups allow-downloads"
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
          ></iframe>
        </div>
        <div class="controls" style="margin-top:10px">
          <button id="btnPhETNewTab" class="ghost">üîó Open in New Tab (if blocked)</button>
          <button id="btnPhETLocal" class="ghost" title="Use a local copy you downloaded">üíæ Use Local Copy</button>
          <span id="phetStatus" class="muted"></span>
        </div>
        <div class="warn" style="margin-top:10px">
          Offline? Download the HTML5 sim and serve it via a local HTTP server. Example:
          <code>http://127.0.0.1/phet/gravity-force-lab_en.html</code> (iframes from <code>file://</code> are blocked).
        </div>
      </section>

      <!-- Mini Interactive (offline srcdoc) ‚Äî g calculator & buoyancy tank -->
      <section class="phet">
        <h3>Mini Interactive: g & Buoyancy</h3>
        <div class="phet-frame">
          <iframe class="phet-embed" title="g & buoyancy mini" srcdoc='<!doctype html><html><head><meta charset="utf-8"><style>body{font-family:system-ui;margin:0;padding:14px;color:#0b3b5a;background:#fff} .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap} .card{border:1px solid #cfeeff;border-radius:12px;padding:12px;margin-top:10px} input[type=range]{width:200px} .pill{display:inline-block;padding:2px 10px;border-radius:999px;background:#eef7ff;border:1px solid #cfeeff} canvas{border:1px solid #cfeeff;border-radius:8px;background:#fff;margin-top:10px} .mini{font-size:12px;color:#4d6b80}</style></head><body>
<h3>Gravity & Buoyancy Sandbox</h3>
<div class="row"><label>Body mass (kg): <input id="m" type="range" min="1" max="100" value="10"></label><span class="pill" id="mv">10 kg</span>
<label>Planet: <select id="pl"><option value="9.8">Earth (g=9.8)</option><option value="1.62">Moon (g=1.62)</option><option value="3.71">Mars (g=3.71)</option><option value="24.79">Jupiter (g=24.79)</option></select></label></div>
<div class="card"><b>Weight W = m g:</b> <span id="W">98.0</span> N</div>
<hr>
<div class="row"><label>Object density (kg/m¬≥): <input id="rho_obj" type="range" min="200" max="12000" value="800"></label><span class="pill" id="rhoov">800</span>
<label>Liquid density (kg/m¬≥): <input id="rho_liq" type="range" min="200" max="2000" value="1000"></label><span class="pill" id="rholv">1000</span>
<label>Volume (litres): <input id="vol" type="range" min="1" max="50" value="10"></label><span class="pill" id="volv">10 L</span></div>
<div class="card"><b>Buoyant force F_b = œÅ_liq g V:</b> <span id="Fb">98.0</span> N ‚Ä¢ <b>Net (down + = sinks):</b> <span id="net">0.0</span> N</div>
<canvas id="cv" width="680" height="220"></canvas>
<p class="mini">If œÅ_object &lt; œÅ_liquid, the object can float (F_b balances weight at partial submergence). Here we show full-submerged net as a quick check.</p>
<script>const $=id=>document.getElementById(id); const cv=$("cv"), ctx=cv.getContext("2d"); function upd(){const m=+$("m").value; const g=+$("pl").value; const rhoo=+$("rho_obj").value; const rhol=+$("rho_liq").value; const V_l=+$("vol").value; const V=V_l/1000; $("mv").textContent=m+" kg"; $("rhoov").textContent=rhoo; $("rholv").textContent=rhol; $("volv").textContent=V_l+" L"; const W=m*g; $("W").textContent=W.toFixed(1); const Fb=rhol*g*V; $("Fb").textContent=Fb.toFixed(1); const m_from_density=rhoo*V; const W_from_density=m_from_density*g; const Net=W_from_density - Fb; $("net").textContent=Net.toFixed(1); draw(Net, W_from_density, Fb);} function arrow(x,y,len,lab){ctx.beginPath(); ctx.moveTo(x,y); ctx.lineTo(x,y+len); ctx.stroke(); ctx.beginPath(); ctx.moveTo(x,y+len); ctx.lineTo(x-5,y+len-8); ctx.lineTo(x+5,y+len-8); ctx.closePath(); ctx.fill(); ctx.fillText(lab, x+8, y+len-6);} function draw(Net,W,Fb){ctx.clearRect(0,0,cv.width,cv.height); ctx.fillStyle="#e0f7fa"; ctx.fillRect(0,140,680,80); ctx.strokeStyle="#0b3b5a"; ctx.fillStyle="#0b3b5a"; ctx.lineWidth=2; // object
ctx.strokeRect(320-25,110,50,50); // forces (down +)
ctx.save(); ctx.translate(345,110); ctx.strokeStyle="#ff4d6d"; ctx.fillStyle="#ff4d6d"; arrow(0,0,Math.min(80, W/10),"W"); ctx.restore(); ctx.save(); ctx.translate(315,160); ctx.rotate(Math.PI); ctx.strokeStyle="#14b86e"; ctx.fillStyle="#14b86e"; arrow(0,0,Math.min(80, Fb/10),"F_b"); ctx.restore(); ctx.fillStyle="#0b3b5a"; ctx.fillText("Net (down +) = "+Net.toFixed(1)+" N", 20, 20);} ["m","pl","rho_obj","rho_liq","vol"].forEach(id=>$(id).addEventListener("input",upd)); upd(); </script>
</body></html>'></iframe>
        </div>
        <p class="mini">Tip: Use Earth/Moon/Mars/Jupiter to compare weight. Adjust densities to see when objects sink or float.</p>
      </section>

      <!-- Quiz -->
      <section class="quiz" id="quiz"></section>

    </div>
  </div>
</div>

<script>
// ----------------------
// Story lines
// ----------------------
const LINES = [
  "Every mass attracts every other mass. The gravitational force is attractive and acts along the line joining the masses.",
  "Universal Law: F = G m‚ÇÅ m‚ÇÇ / r¬≤. Force grows with masses and falls with square of distance.",
  "Near Earth, freely falling bodies have acceleration g ‚âà 9.8 m/s¬≤ downward (ignoring air).",
  "Mass is constant; weight W = m g depends on g (smaller on Moon).",
  "Thrust is force acting on a surface; pressure P = F/A. In fluids, pressure increases with depth.",
  "Archimedes‚Äô principle: Upthrust equals the weight of displaced fluid; objects float if average density is less than the fluid."
];

// ----------------------
// Quiz bank
// ----------------------
const QUIZ = [
  {q:"Gravitational force between two masses varies as‚Ä¶",a:["r","1/r","1/r¬≤"],correct:2},
  {q:"Weight of a 10 kg object on Moon (g ‚âà 1.62 m/s¬≤)",a:["98 N","16.2 N","10 N"],correct:1},
  {q:"Pressure equals‚Ä¶",a:["Force √ó Area","Force / Area","Area / Force"],correct:1},
  {q:"An object floats when‚Ä¶",a:["Its density < fluid density","Its shape is round","It is hollow"],correct:0},
  {q:"Upthrust on a fully submerged body equals‚Ä¶",a:["Weight of body","Weight of displaced fluid","Volume of body"],correct:1}
];

// ----------------------
// TTS (male-preferred) with priming
// ----------------------
let currentIdx = 0; let voices = []; let muted=false; let audioEnabled=false;
const speechBox = document.getElementById('speech');
const lineInfo = document.getElementById('lineInfo');
const btnSpeak = document.getElementById('btnSpeak');
const btnNext = document.getElementById('btnNext');
const btnPrev = document.getElementById('btnPrev');
const btnMute = document.getElementById('btnMute');
const btnEnable = document.getElementById('btnEnable');

function renderLine(){ speechBox.textContent = LINES[currentIdx]; lineInfo.textContent = `Line ${currentIdx+1} of ${LINES.length}`; }
function loadVoices(){ try{ voices = window.speechSynthesis.getVoices(); }catch(e){ voices = []; } }
function pickMaleVoice(){ if(!voices.length) return null; const pref=/(male|daniel|george|brian|english male|barry|david|microsoft|google uk|alex)/i; const en=v=>/en/i.test(v.lang||""); return voices.find(v=>pref.test((v.name||"")+" "+(v.lang||""))&&en(v)) || voices.find(en) || voices[0]; }
function speak(text){ if(muted || !audioEnabled) return; if(!('speechSynthesis' in window)) return; try{ window.speechSynthesis.cancel(); const u=new SpeechSynthesisUtterance(text); loadVoices(); const v=pickMaleVoice(); if(v) u.voice=v; u.pitch=1.0; u.rate=1.03; window.speechSynthesis.speak(u);}catch(e){} }
if('speechSynthesis' in window){ loadVoices(); window.speechSynthesis.onvoiceschanged=()=>{ loadVoices(); }; }
btnEnable.addEventListener('click', ()=>{ audioEnabled = true; try{ window.speechSynthesis.cancel(); const u=new SpeechSynthesisUtterance("Audio enabled."); const v=pickMaleVoice(); if(v) u.voice=v; window.speechSynthesis.speak(u);}catch(e){} btnEnable.textContent = "‚úÖ Audio On"; });
btnSpeak.addEventListener('click', ()=>{ speak(LINES[currentIdx]); });
btnNext.addEventListener('click', ()=>{ if(currentIdx<LINES.length-1){ currentIdx++; renderLine(); } });
btnPrev.addEventListener('click', ()=>{ if(currentIdx>0){ currentIdx--; renderLine(); } });
btnMute.addEventListener('click', ()=>{ muted=!muted; btnMute.textContent = muted? 'üîä Unmute' : 'üîá Mute'; if(muted){ try{ window.speechSynthesis.cancel(); }catch(e){} } });

// ----------------------
// Build Quiz
// ----------------------
const qz = document.getElementById('quiz');
function buildQuiz(){ let html = '<h3>Quiz Time! üéâ</h3>'; QUIZ.forEach((item,i)=>{ html += `<div class="q"><b>${i+1}. ${item.q}</b><div>`; item.a.forEach((opt,j)=>{ html += `<label style="display:block;margin:.25rem 0"><input type='radio' name='q${i}' value='${j}'> ${opt}</label>`; }); html += '</div></div>'; }); html += `<div class='controls'><button id='btnCheck' class='good'>Check Answers</button><button id='btnReset' class='ghost'>Reset</button><span id='result' class='muted'></span></div>`; qz.innerHTML = html; document.getElementById('btnCheck').addEventListener('click', checkQuiz); document.getElementById('btnReset').addEventListener('click', ()=>{ qz.querySelectorAll('input[type=radio]').forEach(r=>r.checked=false); document.getElementById('result').textContent=''; }); }
function checkQuiz(){ let score=0; let answered=0; QUIZ.forEach((item,i)=>{ const chosen=qz.querySelector(`input[name='q${i}']:checked`); if(chosen){answered++; if(Number(chosen.value)===item.correct) score++;} }); const r=document.getElementById('result'); if(answered<QUIZ.length){ r.textContent='Pick an answer for each question.'; return; } r.textContent=(score===QUIZ.length)?'üåü Perfect! Gravitation guru!':`Nice! You got ${score} of ${QUIZ.length}.`; }

// ----------------------
// Explorer (pan, zoom, tap)
// ----------------------
const explorer = document.getElementById('explorer');
const viewport = document.getElementById('viewport');
const zoom = document.getElementById('zoom');
const zoomLabel = document.getElementById('zoomLabel');
const btnCenter = document.getElementById('btnCenter');
const orgName = document.getElementById('orgName');
const orgDesc = document.getElementById('orgDesc');
const orgSpeak = document.getElementById('orgSpeak');
const boardType = document.getElementById('boardType');
const svg = document.getElementById('boardSVG');
const legendList = document.getElementById('legendList');

let pan = {x:0,y:0}; let scale = 1;
function applyTransform(){ viewport.style.transform = `translate(${pan.x}px, ${pan.y}px) scale(${scale})`; }
zoom.addEventListener('input', ()=>{ scale = Number(zoom.value)/100; zoomLabel.textContent = `${zoom.value}%`; applyTransform(); });
btnCenter.addEventListener('click', ()=>{ pan.x = (explorer.clientWidth-1100*scale)/2; pan.y = (explorer.clientHeight-760*scale)/2; applyTransform(); });
window.addEventListener('resize', ()=> btnCenter.click());

let panning=false, sx=0, sy=0, ox=0, oy=0;
explorer.addEventListener('pointerdown', e=>{ if(e.target.closest('.org')) return; panning=true; sx=e.clientX; sy=e.clientY; ox=pan.x; oy=pan.y; explorer.setPointerCapture(e.pointerId); });
explorer.addEventListener('pointermove', e=>{ if(!panning) return; const dx=e.clientX-sx, dy=e.clientY-sy; pan.x = ox + dx; pan.y = oy + dy; applyTransform(); });
explorer.addEventListener('pointerup', e=>{ if(panning){ explorer.releasePointerCapture(e.pointerId); } panning=false; });

// ----------------------
// Boards (SVG) and data
// ----------------------
const INFO = {
  // Universal Law
  law:{name:'Universal Law',desc:'F = G m‚ÇÅ m‚ÇÇ / r¬≤. Attractive force along the line joining masses. G ‚âà 6.67√ó10‚Åª¬π¬π N¬∑m¬≤¬∑kg‚Åª¬≤.'},
  inverse:{name:'Inverse‚ÄëSquare',desc:'Doubling distance makes force one‚Äëfourth; tripling makes it one‚Äëninth.'},
  field:{name:'Gravitational Field',desc:'Region around a mass where another mass experiences gravitational force.'},
  // Free fall & g
  gdef:{name:'g (Acceleration due to Gravity)',desc:'Near Earth, g ‚âà 9.8 m/s¬≤ downward; slightly varies with location and altitude.'},
  eqm:{name:'Equations of Motion',desc:'For vertical motion: v = u + g t, s = u t + ¬Ω g t¬≤, v¬≤ = u¬≤ + 2 g s (take g negative upward).'},
  time:{name:'Time of Fall',desc:'From rest, s = ¬Ω g t¬≤ ‚áí t = ‚àö(2s/g). Without air, all masses fall equally fast.'},
  // Mass & Weight
  mass:{name:'Mass',desc:'Amount of matter; scalar; SI unit kg; constant for a body.'},
  weight:{name:'Weight',desc:'W = m g; varies with g; direction toward Earth‚Äôs centre.'},
  moon:{name:'On the Moon',desc:'g_moon ‚âà 1/6 of Earth; weight becomes ~1/6 but mass unchanged.'},
  // Thrust & Pressure
  thrust:{name:'Thrust & Pressure',desc:'Thrust is force normal to a surface; pressure P = F/A (Pa). Larger area ‚Üí smaller pressure.'},
  fluids:{name:'Fluid Pressure',desc:'In fluids, P increases with depth: P = œÅ g h (for incompressible fluids).'},
  // Archimedes
  arch:{name:'Archimedes‚Äô Principle',desc:'Upthrust equals the weight of fluid displaced; explains floating/sinking.'},
  rel:{name:'Relative Density',desc:'RD = œÅ_object / œÅ_water; if RD < 1, floats in water; unitless.'}
};

const LEGENDS = {
  law:['Universal Law','Inverse‚ÄëSquare','Field'],
  freefall:['g','Equations of Motion','Time of Fall'],
  massweight:['Mass','Weight','On the Moon'],
  pressure:['Thrust & Pressure','Fluid Pressure'],
  arch:['Archimedes‚Äô Principle','Relative Density']
};

function card(x,y,title,key){ return `
  <g class="org" data-key="${key}" role="button" tabindex="0" transform="translate(${x},${y})">
    <rect width="320" height="160" rx="18" fill="#ffffff" stroke="#cfeeff" />
    <text x="16" y="36" font-size="18" font-weight="700" fill="#0b3b5a">${title}</text>
    <text x="16" y="68" font-size="14" fill="#4d6b80">Tap to hear what it means</text>
  </g>`; }

function makeLaw(){ return `
  <rect x="0" y="0" width="1100" height="760" fill="url(#g1)"/>
  <defs><linearGradient id="g1" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#f7fbff"/><stop offset="100%" stop-color="#e9f6ff"/></linearGradient></defs>
  ${card(60,80,'Universal Law','law')}
  ${card(420,80,'Inverse‚ÄëSquare','inverse')}
  ${card(60,280,'Gravitational Field','field')}
  `; }

function makeFreeFall(){ return `
  <rect x="0" y="0" width="1100" height="760" fill="url(#g2)"/>
  <defs><linearGradient id="g2" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#f7fbff"/><stop offset="100%" stop-color="#e9f6ff"/></linearGradient></defs>
  ${card(60,80,'g (Acceleration)','gdef')}
  ${card(420,80,'Equations of Motion','eqm')}
  ${card(60,280,'Time of Fall','time')}
  `; }

function makeMassWeight(){ return `
  <rect x="0" y="0" width="1100" height="760" fill="url(#g3)"/>
  <defs><linearGradient id="g3" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#f7fbff"/><stop offset="100%" stop-color="#e9f6ff"/></linearGradient></defs>
  ${card(60,80,'Mass','mass')}
  ${card(420,80,'Weight','weight')}
  ${card(60,280,'On the Moon','moon')}
  `; }

function makePressure(){ return `
  <rect x="0" y="0" width="1100" height="760" fill="url(#g4)"/>
  <defs><linearGradient id="g4" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#f7fbff"/><stop offset="100%" stop-color="#e9f6ff"/></linearGradient></defs>
  ${card(60,80,'Thrust & Pressure','thrust')}
  ${card(420,80,'Fluid Pressure','fluids')}
  `; }

function makeArch(){ return `
  <rect x="0" y="0" width="1100" height="760" fill="url(#g5)"/>
  <defs><linearGradient id="g5" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#f7fbff"/><stop offset="100%" stop-color="#e9f6ff"/></linearGradient></defs>
  ${card(60,80,'Archimedes‚Äô Principle','arch')}
  ${card(420,80,'Relative Density','rel')}
  `; }

function renderBoard(){ const t = boardType.value; let inner=''; if(t==='law') inner = makeLaw(); if(t==='freefall') inner = makeFreeFall(); if(t==='massweight') inner = makeMassWeight(); if(t==='pressure') inner = makePressure(); if(t==='arch') inner = makeArch(); svg.innerHTML = inner; buildLegend(t); }
function buildLegend(t){ const items = LEGENDS[t]||[]; legendList.innerHTML = items.map(x=>`<span class="pill">${x}</span>`).join(''); }

// Delegated taps
svg.addEventListener('click', e=>{ const t=e.target.closest('.org'); if(!t) return; const key=t.getAttribute('data-key'); say(key); });
svg.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' '){ const t=e.target.closest('.org'); if(t){ e.preventDefault(); say(t.getAttribute('data-key')); } } });
function say(key){ const d=INFO[key]; if(!d) return; orgName.textContent=d.name; orgDesc.textContent=d.desc; speak(`${d.name}. ${d.desc}`); }
orgSpeak.addEventListener('click', ()=>{ if(orgName.textContent && orgDesc.textContent){ speak(`${orgName.textContent}. ${orgDesc.textContent}`); } });
boardType.addEventListener('change', renderBoard);

// ----------------------
// PhET controls (online + local)
// ----------------------
const phetURL = "https://phet.colorado.edu/sims/html/gravity-force-lab/latest/gravity-force-lab_en.html";
const phetFrame = document.getElementById("phetFrame");
const phetStatus = document.getElementById("phetStatus");
(document.getElementById("btnPhETNewTab")||{}).onclick = ()=> window.open(phetURL, "_blank");
(document.getElementById("btnPhETLocal")||{}).onclick = ()=>{ const localURL = "http://127.0.0.1/phet/gravity-force-lab_en.html"; phetFrame.src = localURL; phetStatus.textContent = "Switched to local copy."; };
setTimeout(()=>{ phetStatus.textContent = "If the panel is blank, click Open in New Tab or Use Local Copy."; }, 2500);

// ----------------------
// Init
// ----------------------
function init(){ renderLine(); buildQuiz(); renderBoard(); btnCenter.click(); }
window.addEventListener('load', init);
</script>
</body>
</html>