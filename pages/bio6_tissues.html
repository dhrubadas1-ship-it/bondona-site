<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bondona Tutor ‚Äî Chapter 6: Tissues</title>
  <style>
    :root{ --bg:#f6fbff; --card:#ffffff; --ink:#0b3b5a; --muted:#4d6b80; --accent:#26a6ff; --good:#14b86e; --bad:#ff4d6d; --ring:#d9eefb; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(180deg,var(--bg),#e9f6ff 70%);color:var(--ink)}
    .wrap{max-width:1100px;margin:auto;padding:20px}
    .card{background:var(--card);border-radius:20px;box-shadow:0 10px 30px rgba(13,71,161,.08);padding:20px}
    h1{margin:0 0 6px 0}
    .tag{display:inline-block;background:#eaf7ff;border-radius:999px;padding:4px 10px;color:#1673a6;font-size:12px}
    .grid{display:grid;grid-template-columns: 1fr;gap:20px}
    .speech{position:relative;background:#fff;border:2px solid #d9eefb;border-radius:18px;padding:16px;min-height:120px}
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    button{appearance:none;border:none;background:var(--accent);color:#fff;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;box-shadow:0 6px 16px rgba(38,166,255,.24)}
    button.ghost{background:#eaf7ff;color:#0b5a8a;box-shadow:none}
    .muted{color:#4d6b80;font-size:13px}
    .pill{display:inline-block;padding:2px 10px;border-radius:999px;background:#eef7ff;border:1px solid #cfeeff;color:#0b3b5a;font-size:12px}
    .sim{background:#fff;border:2px solid #d9eefb;border-radius:16px;padding:16px}
    .panel{display:grid;grid-template-columns: 320px 1fr;gap:16px;align-items:stretch}
    .explorer{position:relative;height:460px;border:2px dashed var(--ring);border-radius:16px;overflow:hidden;background:radial-gradient(circle at center, #ffffff 0, #f7fbff 70%)}
    .viewport{position:absolute;left:0;top:0;transform-origin:0 0;cursor:grab;will-change:transform;backface-visibility:hidden;transform:translateZ(0)}
    .viewport:active{cursor:grabbing}
    .legend{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .side{background:#f8fcff;border:1px solid #d9eefb;border-radius:12px;padding:10px}
    .side h4{margin:0 0 6px 0}
    .side .row{display:grid;grid-template-columns: 1fr auto;align-items:center;gap:8px}
    .list{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:6px;margin-top:8px}
    svg *{vector-effect:non-scaling-stroke;shape-rendering:geometricPrecision}
    svg .org{cursor:pointer;transition:filter .2s ease}
    svg .org:hover{filter:brightness(1.08)}
    .quiz{margin-top:18px;background:#fff;border:2px dashed #cfeeff;border-radius:16px;padding:14px}
    .q{margin:10px 0}
    .phet{background:#fff;border:2px solid #d9eefb;border-radius:16px;padding:16px}
    .phet-frame{position:relative;width:100%;height:560px;border-radius:12px;overflow:hidden}
    iframe.phet-embed{width:100%;height:100%;border:0;display:block}
    .warn{background:#fffceb;border:1px solid #ffe08a;border-radius:10px;padding:10px}
    /* gentle hotspot pulse */
    .pulse{position:relative}
    .pulse::after{content:"";position:absolute;inset:-8px;border:2px solid #cfeeff;border-radius:999px;opacity:.6;animation:pulse 1.8s ease-out infinite}
    @keyframes pulse{0%{transform:scale(.85);opacity:.6}70%{transform:scale(1.15);opacity:0}100%{transform:scale(1.15);opacity:0}}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Chapter 6: Tissues</h1>
    <div class="tag">Tap to explore Plant and Animal tissues ‚Äî with a mini Blood smear!</div>

    <div class="grid">
      <!-- Story -->
      <section>
        <div class="speech" id="speech"></div>
        <div class="controls">
          <button id="btnPrev" class="ghost">‚óÅ Prev</button>
          <button id="btnNext">Next ‚ñ∑</button>
          <button id="btnEnable" class="ghost">üîä Enable Audio</button>
          <button id="btnSpeak">‚ñ∂ Narrate (Male)</button>
          <span class="muted" id="lineInfo"></span>
        </div>
      </section>

      <!-- Zoomable Tissues Explorer -->
      <section class="sim">
        <h3>Lab: Zoom & Tap the Tissues</h3>
        <div class="panel">
          <div class="side">
            <div class="row"><h4>Choose Board</h4>
              <select id="boardType" style="padding:8px;border:2px solid #cfeeff;border-radius:10px;font-weight:700;color:#0b3b5a">
                <option value="plant">Plant Tissues</option>
                <option value="animal">Animal Tissues</option>
                <option value="blood">Blood Components</option>
              </select>
            </div>
            <div class="row" style="margin-top:8px"><span class="pill">Zoom: <span id="zoomLabel">100%</span></span>
              <input id="zoom" type="range" min="80" max="200" value="100" step="5">
            </div>
            <div class="legend">
              <span class="pill">Tap items ‚Üí hear + learn</span>
              <button id="btnCenter" class="ghost">üéØ Center</button>
              <button id="btnMute" class="ghost">üîá Mute</button>
            </div>
            <div class="side" id="infoBox" style="margin-top:10px">
              <h4 id="orgName">Tap an item</h4>
              <div id="orgDesc" class="muted">I will tell you what it does!</div>
              <div class="controls" style="margin-top:8px">
                <button id="orgSpeak" class="ghost">‚ñ∂ Speak</button>
              </div>
            </div>

            <div class="list" id="legendList">
              <!-- Populated per board -->
            </div>
          </div>

          <div class="explorer" id="explorer">
            <div class="viewport" id="viewport">
              <!-- SVG boards will be swapped here -->
              <svg id="boardSVG" viewBox="0 0 1100 700" width="1100" height="700" aria-label="Tissue boards"></svg>
            </div>
          </div>
        </div>
        <p class="muted">Tip: Use the slider to zoom. Drag the background to pan. Tap a card or dot to hear and learn. Switch boards from the dropdown.</p>
      </section>

      <!-- PhET HTML5 Embed (online + fallbacks) -->
      <section class="phet">
        <h3>Interactive: PhET ‚Äî Membrane Channels (HTML5)</h3>
        <div class="phet-frame">
          <iframe
            id="phetFrame"
            class="phet-embed"
            title="PhET Membrane Channels"
            src="https://phet.colorado.edu/sims/html/membrane-channels/latest/membrane-channels_en.html"
            allow="fullscreen; gamepad; xr-spatial-tracking; clipboard-read; clipboard-write"
            sandbox="allow-scripts allow-forms allow-same-origin allow-pointer-lock allow-popups allow-downloads"
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
          ></iframe>
        </div>
        <div class="controls" style="margin-top:10px">
          <button id="btnPhETNewTab" class="ghost">üîó Open in New Tab (if blocked)</button>
          <button id="btnPhETLocal" class="ghost" title="Use a local copy you downloaded">üíæ Use Local Copy</button>
          <span id="phetStatus" class="muted"></span>
        </div>
        <div class="warn" style="margin-top:10px">
          Offline? Download the HTML5 sim and serve it via a local HTTP server (iframes from <code>file://</code> are blocked).
          Example: <code>http://127.0.0.1/phet/membrane-channels_en.html</code>.
        </div>
      </section>

      <!-- Quiz -->
      <section class="quiz" id="quiz"></section>

    </div>
  </div>
</div>

<script>
/* ----------------------
   Story lines (5‚Äì10 yrs)
---------------------- */
const LINES = [
  "Welcome! Today we learn about tissues ‚Äî groups of cells that work together.",
  "Plants have meristematic tissues for growth and permanent tissues for jobs.",
  "Animal tissues include epithelial, connective, muscle and nervous.",
  "Blood is a connective tissue with red cells, white cells and platelets.",
  "Tap the boards to explore examples and what they do!"
];

/* ----------------------
   Quiz bank
---------------------- */
const QUIZ = [
  {q:"Which tissue in plants helps the plant grow longer or thicker?",a:["Meristematic tissue","Parenchyma","Sclerenchyma"],correct:0},
  {q:"Which animal tissue covers surfaces and lines organs?",a:["Muscle","Nervous","Epithelial"],correct:2},
  {q:"Which blood component carries oxygen?",a:["White blood cells","Platelets","Red blood cells"],correct:2},
  {q:"Sclerenchyma cells are‚Ä¶",a:["Dead at maturity and very strong","Always green with chlorophyll","Liquid"],correct:0},
  {q:"Phloem mainly transports‚Ä¶",a:["Water and minerals up","Food/sugars to different parts","Air into leaves"],correct:1}
];

/* ----------------------
   TTS (male-preferred) with priming + refresh
---------------------- */
let currentIdx = 0; let voices = []; let muted=false; let audioEnabled=false;
const speechBox = document.getElementById('speech');
const lineInfo = document.getElementById('lineInfo');
const btnSpeak = document.getElementById('btnSpeak');
const btnNext = document.getElementById('btnNext');
const btnPrev = document.getElementById('btnPrev');
const btnMute = document.getElementById('btnMute');
const btnEnable = document.getElementById('btnEnable');

function renderLine(){ speechBox.textContent = LINES[currentIdx]; lineInfo.textContent = `Line ${currentIdx+1} of ${LINES.length}`; }
function loadVoices(){ try{ voices = window.speechSynthesis.getVoices(); }catch(e){ voices = []; } }
function pickMaleVoice(){
  if(!voices.length) return null;
  const pref=/(male|daniel|george|brian|english male|barry|david|microsoft|google uk|alex)/i;
  const en=v=>/en/i.test(v.lang||"");
  return voices.find(v=>pref.test((v.name||"")+" "+(v.lang||""))&&en(v)) || voices.find(en) || voices[0];
}
function speak(text){
  if(muted || !audioEnabled) return;
  if(!('speechSynthesis' in window)) return;
  try{
    window.speechSynthesis.cancel();
    const u=new SpeechSynthesisUtterance(text);
    loadVoices();
    const v=pickMaleVoice(); if(v) u.voice=v;
    u.pitch=1.0; u.rate=1.03;
    u.onerror=()=>{}; u.onend=()=>{};
    window.speechSynthesis.speak(u);
  }catch(e){}
}
if('speechSynthesis' in window){
  loadVoices();
  window.speechSynthesis.onvoiceschanged=()=>{ loadVoices(); };
}
document.addEventListener('visibilitychange', ()=>{
  if(document.visibilityState==='visible' && audioEnabled){ loadVoices(); }
});

btnEnable.addEventListener('click', ()=>{
  audioEnabled = true;
  try{ window.speechSynthesis.cancel(); const u=new SpeechSynthesisUtterance("Audio enabled."); const v=pickMaleVoice(); if(v) u.voice=v; window.speechSynthesis.speak(u);}catch(e){}
  btnEnable.textContent = "‚úÖ Audio On";
});
btnSpeak.addEventListener('click', ()=>{ speak(LINES[currentIdx]); });
btnNext.addEventListener('click', ()=>{ if(currentIdx<LINES.length-1){ currentIdx++; renderLine(); } });
btnPrev.addEventListener('click', ()=>{ if(currentIdx>0){ currentIdx--; renderLine(); } });
btnMute.addEventListener('click', ()=>{ muted=!muted; btnMute.textContent = muted? 'üîä Unmute' : 'üîá Mute'; if(muted){ try{ window.speechSynthesis.cancel(); }catch(e){} } });

/* ----------------------
   Build Quiz
---------------------- */
const qz = document.getElementById('quiz');
function buildQuiz(){
  let html = '<h3>Quiz Time! üéâ</h3>';
  QUIZ.forEach((item,i)=>{
    html += `<div class="q"><b>${i+1}. ${item.q}</b><div>`;
    item.a.forEach((opt,j)=>{
      html += `<label style="display:block;margin:.25rem 0"><input type='radio' name='q${i}' value='${j}'> ${opt}</label>`;
    });
    html += '</div></div>';
  });
  html += `<div class='controls'><button id='btnCheck' class='good'>Check Answers</button><button id='btnReset' class='ghost'>Reset</button><span id='result' class='muted'></span></div>`;
  qz.innerHTML = html;
  document.getElementById('btnCheck').addEventListener('click', checkQuiz);
  document.getElementById('btnReset').addEventListener('click', ()=>{ qz.querySelectorAll('input[type=radio]').forEach(r=>r.checked=false); document.getElementById('result').textContent=''; });
}
function checkQuiz(){
  let score=0; let answered=0;
  QUIZ.forEach((item,i)=>{
    const chosen=qz.querySelector(`input[name='q${i}']:checked`);
    if(chosen){answered++; if(Number(chosen.value)===item.correct) score++;}
  });
  const r=document.getElementById('result');
  if(answered<QUIZ.length){ r.textContent='Pick an answer for each question.'; return; }
  r.textContent=(score===QUIZ.length)?'üåü Perfect! Tissue master!':`Nice! You got ${score} of ${QUIZ.length}.`;
}

/* ----------------------
   Explorer (pan, zoom, tap)
---------------------- */
const explorer = document.getElementById('explorer');
const viewport = document.getElementById('viewport');
const zoom = document.getElementById('zoom');
const zoomLabel = document.getElementById('zoomLabel');
const btnCenter = document.getElementById('btnCenter');
const orgName = document.getElementById('orgName');
const orgDesc = document.getElementById('orgDesc');
const orgSpeak = document.getElementById('orgSpeak');
const boardType = document.getElementById('boardType');
const svg = document.getElementById('boardSVG');
const legendList = document.getElementById('legendList');

let pan = {x:0,y:0}; let scale = 1;
function applyTransform(){ viewport.style.transform = `translate(${pan.x}px, ${pan.y}px) scale(${scale})`; }
zoom.addEventListener('input', ()=>{ scale = Number(zoom.value)/100; zoomLabel.textContent = `${zoom.value}%`; applyTransform(); });
btnCenter.addEventListener('click', ()=>{ pan.x = (explorer.clientWidth-1100*scale)/2; pan.y = (explorer.clientHeight-700*scale)/2; applyTransform(); });
window.addEventListener('resize', ()=> btnCenter.click());

// Only pan when background is dragged (not when clicking a card/dot)
let panning=false, sx=0, sy=0, ox=0, oy=0;
explorer.addEventListener('pointerdown', e=>{
  if(e.target.closest('.org')) return; // let hotspots pass through
  panning=true; sx=e.clientX; sy=e.clientY; ox=pan.x; oy=pan.y; explorer.setPointerCapture(e.pointerId);
});
explorer.addEventListener('pointermove', e=>{
  if(!panning) return; const dx=e.clientX-sx, dy=e.clientY-sy; pan.x = ox + dx; pan.y = oy + dy; applyTransform();
});
explorer.addEventListener('pointerup', e=>{ if(panning){ explorer.releasePointerCapture(e.pointerId); } panning=false; });

/* ----------------------
   Boards (SVG) and data
---------------------- */
const INFO = {
  // Plant
  meristem:{name:'Meristematic Tissue',desc:'Actively dividing cells at shoot and root tips (apical), between nodes (intercalary) and in cambium (lateral). Cause growth.'},
  parenchyma:{name:'Parenchyma',desc:'Thin-walled living cells for storage and photosynthesis (chlorenchyma has chlorophyll).'},
  collenchyma:{name:'Collenchyma',desc:'Cells with unevenly thickened corners. Provide flexible support to young stems and petioles.'},
  sclerenchyma:{name:'Sclerenchyma',desc:'Thick, lignified walls. Cells dead at maturity; give strong mechanical support.'},
  xylem:{name:'Xylem',desc:'Transports water and minerals upward via vessels/tracheids; fibres for strength; some parenchyma.'},
  phloem:{name:'Phloem',desc:'Transports food/sugars through sieve tubes and companion cells; also fibres and parenchyma.'},
  // Animal
  epithelial:{name:'Epithelial Tissue',desc:'Covers body surfaces and lines cavities and organs. Types: squamous, cuboidal, columnar.'},
  connective:{name:'Connective Tissue',desc:'Loose, dense, adipose, cartilage, bone, blood ‚Äî for support, binding, and transport.'},
  muscle:{name:'Muscle Tissue',desc:'Skeletal (voluntary, striated), smooth (involuntary), and cardiac (heart).'},
  nervous:{name:'Nervous Tissue',desc:'Neurons and neuroglia. Receive and transmit impulses; brain, spinal cord, nerves.'},
  adipose:{name:'Adipose Tissue',desc:'Stores fat, provides insulation and cushioning under skin and around organs.'},
  cartilage:{name:'Cartilage',desc:'Flexible support with chondrocytes in lacunae; in nose, ear, trachea.'},
  // Blood
  rbc:{name:'Red Blood Cells (RBCs)',desc:'Carry oxygen using haemoglobin. Biconcave shape increases surface area.'},
  wbc:{name:'White Blood Cells (WBCs)',desc:'Defend the body against pathogens and provide immunity.'},
  platelet:{name:'Platelets',desc:'Help in blood clotting by forming plugs and releasing clotting factors.'}
};

const LEGENDS = {
  plant:['Meristematic','Parenchyma','Collenchyma','Sclerenchyma','Xylem','Phloem'],
  animal:['Epithelial','Connective','Muscle','Nervous','Adipose','Cartilage'],
  blood:['RBC','WBC','Platelet']
};

function makePlantBoard(){
  return `
  <defs><filter id="shadow"><feDropShadow dx="0" dy="2" stdDeviation="2" flood-color="#8ec9ff" flood-opacity=".25"/></filter></defs>
  <rect x="0" y="0" width="1100" height="700" fill="url(#pgrad)"/>
  <defs>
    <linearGradient id="pgrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#f7fbff"/><stop offset="100%" stop-color="#e9f6ff"/>
    </linearGradient>
  </defs>
  ${card(60,80,'Meristematic','meristem')}
  ${card(420,80,'Parenchyma','parenchyma')}
  ${card(780,80,'Collenchyma','collenchyma')}
  ${card(60,300,'Sclerenchyma','sclerenchyma')}
  ${card(420,300,'Xylem','xylem')}
  ${card(780,300,'Phloem','phloem')}
  `;
}
function makeAnimalBoard(){
  return `
  <rect x="0" y="0" width="1100" height="700" fill="url(#agrad)"/>
  <defs>
    <linearGradient id="agrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#f7fbff"/><stop offset="100%" stop-color="#e9f6ff"/>
    </linearGradient>
  </defs>
  ${card(60,80,'Epithelial','epithelial')}
  ${card(420,80,'Connective','connective')}
  ${card(780,80,'Muscle','muscle')}
  ${card(60,300,'Nervous','nervous')}
  ${card(420,300,'Adipose','adipose')}
  ${card(780,300,'Cartilage','cartilage')}
  `;
}
function makeBloodBoard(){
  const rbcDots = Array.from({length:18}).map((_,i)=>{
    const col=i%9, row=(i/9|0);
    const x=80+col*110, y=120+row*140;
    return `<g class="org" data-key="rbc" role="button" tabindex="0">
      <circle cx="${x}" cy="${y}" r="34" fill="#ff6b6b" fill-opacity=".14" stroke="#ff8fa3" />
      <circle cx="${x}" cy="${y}" r="16" fill="none" stroke="#ff8fa3" stroke-dasharray="3 4"/>
    </g>`;
  }).join('');
  const platelets = Array.from({length:6}).map((_,i)=>{
    const x=860+(i%3)*70, y=300+Math.floor(i/3)*60;
    return `<rect class="org pulse" data-key="platelet" x="${x}" y="${y}" width="18" height="12" rx="3" fill="#14b86e" fill-opacity=".25" stroke="#7ad9a5"/>`;
  }).join('');
  return `
  <rect x="0" y="0" width="1100" height="700" fill="url(#bgrad)"/>
  <defs>
    <linearGradient id="bgrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#fffafc"/><stop offset="100%" stop-color="#f7fbff"/>
    </linearGradient>
  </defs>
  <g>
    <rect x="40" y="60" width="1020" height="560" rx="22" fill="#ffffff" stroke="#cfeeff"/>
    <text x="60" y="96" font-size="20" font-weight="700" fill="#0b3b5a">Blood smear (schematic)</text>
    ${rbcDots}
    <g class="org pulse" data-key="wbc" role="button" tabindex="0" transform="translate(940,200)">
      <circle cx="0" cy="0" r="46" fill="#7c4dff" fill-opacity=".18" stroke="#b39ddb"/>
    </g>
    ${platelets}
  </g>
  `;
}
function card(x,y,title,key){
  return `
  <g class="org" data-key="${key}" role="button" tabindex="0" transform="translate(${x},${y})">
    <rect width="260" height="160" rx="18" fill="#ffffff" stroke="#cfeeff" />
    <text x="16" y="36" font-size="18" font-weight="700" fill="#0b3b5a">${title}</text>
    <text x="16" y="68" font-size="14" fill="#4d6b80">Tap to hear what it does</text>
  </g>`;
}

function renderBoard(){
  const type = boardType.value;
  let inner='';
  if(type==='plant') inner = makePlantBoard();
  if(type==='animal') inner = makeAnimalBoard();
  if(type==='blood') inner = makeBloodBoard();
  svg.innerHTML = inner;
  buildLegend(type);
}

function buildLegend(type){
  const list = LEGENDS[type] || [];
  legendList.innerHTML = list.map(label=>`<span class="pill">${label}</span>`).join('');
}

// tap handlers (delegate)
svg.addEventListener('click', e=>{
  const t = e.target.closest('.org'); if(!t) return;
  const key=t.getAttribute('data-key'); chooseItem(key);
});
svg.addEventListener('keydown', e=>{
  if(e.key==='Enter' || e.key===' '){
    const t=e.target.closest('.org'); if(t){ e.preventDefault(); chooseItem(t.getAttribute('data-key')); }
  }
});

function chooseItem(key){
  const data = INFO[key]; if(!data) return;
  orgName.textContent = data.name; orgDesc.textContent = data.desc; speak(`${data.name}. ${data.desc}`);
}

orgSpeak.addEventListener('click', ()=>{ if(orgName.textContent && orgDesc.textContent){ speak(`${orgName.textContent}. ${orgDesc.textContent}`); } });

boardType.addEventListener('change', ()=>{ renderBoard(); });

/* ----------------------
   PhET controls (online + local)
---------------------- */
const phetURL = "https://phet.colorado.edu/sims/html/membrane-channels/latest/membrane-channels_en.html";
const phetFrame = document.getElementById("phetFrame");
const phetStatus = document.getElementById("phetStatus");
document.getElementById("btnPhETNewTab").addEventListener("click", ()=> window.open(phetURL, "_blank"));

document.getElementById("btnPhETLocal").addEventListener("click", ()=>{
  // Change this to your local HTTP path once you host the downloaded sim
  const localURL = "http://127.0.0.1/phet/membrane-channels_en.html";
  phetFrame.src = localURL;
  phetStatus.textContent = "Switched to local copy.";
});

// Soft hint if the embed looks blank to user (cannot detect cross-origin reliably)
setTimeout(()=>{ phetStatus.textContent = "If the panel is blank, click Open in New Tab or Use Local Copy."; }, 2500);

/* ----------------------
   Init after load
---------------------- */
function buildLegendAndCenter(){ renderBoard(); btnCenter.click(); }
window.addEventListener('load', ()=>{ renderLine(); buildQuiz(); buildLegendAndCenter(); });
</script>
</body>
</html>
